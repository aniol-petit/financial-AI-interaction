<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Dashboard</title>
    <link rel="stylesheet" href="styles/dashboard_styles.css">
</head>
<body>

    <!-- Background Elements -->
    <div class="background-overlay"></div>
    <img src="assets/stock_market.gif" class="background-gif" alt="Stock Market Animation">

    <!-- Sidebar for Clients -->
    <div class="sidebar">
        <button class="back-button" onclick="window.location.href='index.html'">‚Üê</button>

        <h2>CLIENTS</h2>

        <!-- üîç Search Bar (Restored) -->
        <input type="text" id="search-bar" placeholder="Search client..." onkeyup="filterClients()">

        <ul id="client-list">
            <li class="client-item" data-client-id="1">
                <img src="assets/john.png" class="client-img"> 
                <span class="client-name" onclick="redirectToClient('1')">John Doe</span>
                <div class="client-options">
                    <span class="menu-icon" onclick="toggleMenu(event, 'menu-1')">‚ãÆ</span>
                    <div class="menu-dropdown" id="menu-1">
                        <button onclick="editClient('1')">Edit Client</button>
                        <button onclick="deleteClient('1')">Delete Client</button>
                    </div>
                </div>
            </li>
            <li class="client-item" data-client-id="2">
                <img src="assets/jane.png" class="client-img"> 
                <span class="client-name" onclick="redirectToClient('2')">Jane Smith</span>
                <div class="client-options">
                    <span class="menu-icon" onclick="toggleMenu(event, 'menu-2')">‚ãÆ</span>
                    <div class="menu-dropdown" id="menu-2">
                        <button onclick="editClient('2')">Edit Client</button>
                        <button onclick="deleteClient('2')">Delete Client</button>
                    </div>
                </div>
            </li>
            <li class="client-item" data-client-id="3">
                <img src="assets/michael.png" class="client-img"> 
                <span class="client-name" onclick="redirectToClient('3')">Michael Brown</span>
                <div class="client-options">
                    <span class="menu-icon" onclick="toggleMenu(event, 'menu-3')">‚ãÆ</span>
                    <div class="menu-dropdown" id="menu-3">
                        <button onclick="editClient('3')">Edit Client</button>
                        <button onclick="deleteClient('3')">Delete Client</button>
                    </div>
                </div>
            </li>
        </ul>
    </div>

    <!-- Client Edit Form (Hidden by Default) -->
    <div id="edit-client-modal" class="modal hidden">
        <div class="modal-content">
            <h2>Edit Client</h2>
            <input type="text" id="edit-name" placeholder="Name">
            <input type="number" id="edit-age" placeholder="Age">
            <input type="text" id="edit-risk" placeholder="Risk Level">
            <input type="text" id="edit-goals" placeholder="Financial Goals">
            <button onclick="saveClientChanges()">Save Changes</button>
            <button onclick="closeEditModal()">Cancel</button>
        </div>
    </div>

    <!-- Crypto Ticker -->
    <div class="crypto-ticker">
        <div class="ticker-content">
            <span><img src="assets/bitcoin.png" class="crypto-logo"> BTC: $63,500</span>
            <span><img src="assets/ethereum.png" class="crypto-logo"> ETH: $3,400</span>
            <span><img src="assets/apple.png" class="crypto-logo"> AAPL: $150.34</span>
            <span><img src="assets/tesla.png" class="crypto-logo"> TSLA: $250.12</span>
            <span><img src="assets/microsoft.png" class="crypto-logo"> MSFT: $320.80</span>
            <span><img src="assets/google.png" class="crypto-logo"> GOOGL: $2750.10</span>
            <span><img src="assets/cardano.png" class="crypto-logo"> ADA: $1.25</span>
            <span><img src="assets/solana.png" class="crypto-logo"> SOL: $150.75</span>
            <span><img src="assets/ripple.png" class="crypto-logo"> XRP: $0.85</span>
        </div>
    </div>

    <div class="bell-container">
        <img src="assets/bell.png" class="client-image" id="bell" onclick="showNotification()">
        <div id="notification-indicator"></div>
    </div>
    
    <button id="trigger-alarm-btn" onclick="triggerAlarm()">‚ö†Ô∏è</button>
    
    <div id="notification-box" class="notification-box">
        <p id="notification-message">No notifications</p>
        <button id="mark-read-btn" onclick="markAsRead()">Mark as Read</button>
    </div>

    <script>
        function redirectToClient(clientId) {
            fetch("data/clients.json")
            .then(response => response.json())
            .then(data => {
                const client = data.clients.find(c => c.id === clientId);
                if (client) {
                    localStorage.setItem("selectedClient", JSON.stringify(client));
                    window.location.href = `client.html`;
                }
            })
            .catch(error => console.error("Error loading client data:", error));
        }

        function filterClients() {
            let input = document.getElementById("search-bar").value.toUpperCase();
            let clients = document.querySelectorAll(".client-item");

            clients.forEach(client => {
                let name = client.querySelector(".client-name").innerText.toUpperCase();
                client.style.display = name.includes(input) ? "" : "none";
            });
        }

        function toggleMenu(event, menuId) {
            event.stopPropagation();
            document.querySelectorAll('.menu-dropdown').forEach(menu => {
                if (menu.id !== menuId) menu.style.display = "none";
            });
            let menu = document.getElementById(menuId);
            menu.style.display = menu.style.display === "block" ? "none" : "block";
        }

        function editClient(clientId) {
            fetch("data/clients.json")
            .then(response => response.json())
            .then(data => {
                const client = data.clients.find(c => c.id === clientId);
                if (client) {
                    document.getElementById("edit-name").value = client.name;
                    document.getElementById("edit-age").value = client.age;
                    document.getElementById("edit-risk").value = client.risk;
                    document.getElementById("edit-goals").value = client.goals;

                    document.getElementById("edit-client-modal").classList.remove("hidden");
                    document.getElementById("edit-client-modal").setAttribute("data-client-id", clientId);
                }
            })
            .catch(error => console.error("Error loading client data:", error));
        }

        function saveClientChanges() {
            let clientId = document.getElementById("edit-client-modal").getAttribute("data-client-id");
            let newName = document.getElementById("edit-name").value;
            let newAge = document.getElementById("edit-age").value;
            let newRisk = document.getElementById("edit-risk").value;
            let newGoals = document.getElementById("edit-goals").value;

            let client = document.querySelector(`.client-item[data-client-id="${clientId}"]`);
            client.querySelector(".client-name").textContent = newName;

            closeEditModal();
        }

        function closeEditModal() {
            document.getElementById("edit-client-modal").classList.add("hidden");
        }

        function deleteClient(clientId) {
            let confirmation = confirm("Are you sure you want to delete this client?");
            if (confirmation) {
                document.querySelector(`.client-item[data-client-id="${clientId}"]`).remove();
                alert("Client removed successfully!");
            }
        }

        document.addEventListener("click", () => {
            document.querySelectorAll('.menu-dropdown').forEach(menu => menu.style.display = "none");
        });

        // Function to show the notification message
        function showNotification() {
            var notificationBox = document.getElementById('notification-box');
            var message = document.getElementById('notification-message');

            // Check if there are active notifications
            if (document.getElementById('notification-indicator').style.display === 'block') {
                message.textContent = "Donald Trump latest actions have caused a crypto market crash! Get all the information in the following link: [Link]. Also don't forget to alert John Doe and Michael Brown about this situation!";
            } else {
                message.textContent = "No notifications";
            }

            // Display the notification box
            notificationBox.style.display = 'block';
        }

        // Function to simulate the alarm trigger
        function triggerAlarm() {
            var indicator = document.getElementById('notification-indicator');

            // Show the red notification circle
            indicator.style.display = 'block';
        }

        // Function to mark the message as read
        function markAsRead() {
            var notificationBox = document.getElementById('notification-box');
            var indicator = document.getElementById('notification-indicator');
            var message = document.getElementById('notification-message');

            // Mark as read
            message.textContent = "No notifications";

            // Hide red circle
            indicator.style.display = 'none';

            // Hide the notification box
            notificationBox.style.display = 'none';
        }

        // Close notification box when clicking outside
        window.addEventListener('click', function(event) {
            var bell = document.getElementById('bell');
            var notificationBox = document.getElementById('notification-box');
            var triggerButton = document.getElementById('trigger-alarm-btn');

            if (!bell.contains(event.target) && !notificationBox.contains(event.target) && !triggerButton.contains(event.target)) {
                notificationBox.style.display = 'none';
            }
        });

    </script>

</body>
</html>
